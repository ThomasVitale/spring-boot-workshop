# Bootstrapping Java Applications

## Learning goals

* Initialize a new Spring Boot project
* Understand embedded servers and externalized configuration
* Run the application in a local environment in development mode
* Package and run applications as JARs

## Overview

In this exercise, you will initialize the skeleton for an Instrument Service application to manage musical instruments.

* Initialize a new Spring Boot project from [Spring Initializr](https://start.spring.io) with Java 17,  `Spring Web`, and `Spring Boot DevTools`.

* Implement a method handling requests to the `/` endpoint and returning a `String`.

* Configure the server port to `8080`.

* Run the application on your local environment in development mode.

* Package the application as a JAR artifact and run it from the `java` CLI.

* Try different combinations of CLI arguments, JVM system properties, and environment variables to overwrite the server port value when running the application from the JAR artifact.

## Details

### Initialize a Spring Boot project

You can initialize a new Spring Boot project for **Instrument Service** from [Spring Initializr](https://start.spring.io).

Configure the project as follows:

* _Project_: Gradle
* _Language_: Java
* _Spring Boot_: 3.1.0
* _Name_: instrument-service
* _Packaging_: JAR
* _Java_: 17+

Choose the following dependencies:

* _Spring Web (`org.springframework.boot:spring-boot-starter-web`)_ provides the necessary libraries for building web applications with Spring MVC and includes Tomcat as the default embedded server.
* _Spring Boot DevTools (`org.springframework.boot:spring-boot-starter-web`)_ provides fast application restarts, LiveReload, and configurations for enhanced development experience.

If you prefer, you can initialize the project from the CLI.

```bash
curl https://start.spring.io/starter.zip -d groupId=com.example -d artifactId=instrument-service -d name=instrument-service -d packageName=com.example.instrumentservice -d dependencies=web,devtools -d javaVersion=17 -d bootVersion=3.1.0 -d type=gradle-project -o instrument-service.zip
```

Once you're done, open the project in your favourite IDE. 

### Implement an HTTP endpoint

Create a new `WelcomeController` class to handle HTTP requests to the `/` endpoint.

```java
@RestController
class WelcomeController {

  @GetMapping("/")
  String getMessage() {
    return "Welcome to the Instrument Service!";
  }

}
```

The controller makes use of a few annotations:
* `@RestController` is a stereotype annotation marking a class as a Spring component and as a source of handlers
  for REST endpoints.
* `@GetMapping` maps HTTP GET requests to the root endpoint (`/`) onto the specific handler method.

### Configure the server port

Replace the autogenerated `application.properties` file with `application.yml` and configure the server port.

```yaml
server:
  port: 8080
```

### Live reload in development mode

You can run the application in development mode, including the live reload functionality.

```bash
./gradlew bootRun
```

You can now test the application works correctly.

```bash
http :8080/
```

Update the welcome message and notice how the application will automatically reload the changed class.

### Package the application as JAR

From a Terminal window, run this command to package the Spring Boot application as a standalone JAR artifact.

```bash
./gradlew bootJar
```

Then, run the application using the `java` CLI.

```bash
java -jar build/libs/instrument-service-0.0.1-SNAPSHOT.jar 
```

You can now test the application works correctly.

```bash
$ http :8080/
```

Next, experiment with the externalized configuration features provided by Spring Boot. First, use a CLI argument.

```bash
$ java -jar build/libs/instrument-service-0.0.1-SNAPSHOT.jar --server.port=8181
```

Then, you can try with a JVM system property.

```bash
$ java -Dserver.port=8282 -jar build/libs/instrument-service-0.0.1-SNAPSHOT.jar
```

Spring Boot follows specific precedence rules. If both JVM system property and CLI argument are configured, the latter takes precedence.

```bash
$ java -Dserver.port=8282 -jar build/libs/instrument-service-0.0.1-SNAPSHOT.jar --server.port=8181
```

Finally, configure the server port with an environment variable.

```bash
$ export SERVER_PORT=8383 && java -jar build/libs/instrument-service-0.0.1-SNAPSHOT.jar
```

On the Spring Boot [documentation](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.external-config), you can find the list of property sources considered by the framework and their precedence.
